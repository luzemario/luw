#!/bin/bash
#--------------------------------------------------------------------------------#
#               LUW-MDC - Monitor de memoria, disco e cpu                        #
#                  CREATED BY: maik.alberto@hotmail.com                          #
#--------------------------------------------------------------------------------#
echo -e "Content-type: text/html\n\n"

#--------------------------------------------------------------------------------#
#                                HTML CSS STYLE                                  #
#--------------------------------------------------------------------------------#
cat <<EOF
<html>
 <head>
  <title>LUW - IaaS Project </title>
   </style>
 </head>
 <body>
EOF


echo "<table border=0>"
#--------------------------------------------------------------------------------#
#               		  MEMORY     				         #
#--------------------------------------------------------------------------------#
echo "<tr><td align='right'><b>-=SERVER=-</b></td></tr>"
echo "<tr><td bgcolor='F5F5F5'><b><i>MEM</i></b></td></tr>"
echo "<tr><td><pre>"
free -h
echo "</pre></td></tr>"
#--------------------------------------------------------------------------------#
#               		  DISC     				         #
#--------------------------------------------------------------------------------#
echo "<tr><td bgcolor='F5F5F5'><b><i>DISC</i></b></td></tr>"
echo "<tr><td><pre>"
df -h /dev/sda1
echo "</pre></td></tr>"
#--------------------------------------------------------------------------------#
#               		   CPU                              		 #
#--------------------------------------------------------------------------------#
echo "<tr><td bgcolor='F5F5F5'><b><i>CPU</i></b></td></tr>"
echo "<tr><td><pre>"
cat /proc/cpuinfo | head -5 | tail -1
cat <(grep 'cpu ' /proc/stat) <(sleep 1 && grep 'cpu ' /proc/stat) | awk -v RS="" '{print ($13-$2+$15-$4)*100/($13-$2+$15-$4+$16-$5) "%"}'
echo "</pre></td></tr>"
#--------------------------------------------------------------------------------#
#               		   LXC-MONITOR                              		 #
#--------------------------------------------------------------------------------#
echo "<tr><td bgcolor='F5F5F5'><b><i>LXC - MONITOR</i></b></td></tr>"
echo "<tr><td><pre>"

        ps -aux | grep 'lxc monitor' | grep -v grep
echo "</pre></td></tr>"
#--------------------------------------------------------------------------------#
#               		   USERS                              		 #
#--------------------------------------------------------------------------------#
echo "<tr><td bgcolor='F5F5F5'><b><i>USERS</i></b></td></tr>"
echo "<tr><td><pre>"

        ls /home
echo "</pre></td></tr>"
#--------------------------------------------------------------------------------#
#               		   RELOAD                              		 #
#--------------------------------------------------------------------------------#
echo "<meta http-equiv='refresh' content='0';>"
#</table> Remove - erro no log

